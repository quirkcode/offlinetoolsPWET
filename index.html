<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Work Events Offline Tool</title>
    <style>
    <!-- redeploy trigger -->

#loginForm {
    display: flex;
    flex-direction: column;
    width: 300px;
    margin: 100px auto; /* Centering the form */
    border: 2px solid #ccc;
    border-radius: 10px;
    padding: 20px;
}

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            font-size: 10px;
        }
        .form-title {
            text-align: center;
            font-weight: bold;
            font-size: 2em;
            margin-bottom: 1em;
            color: #333333;
        }
        .container {
            display: flex;
            flex-wrap: nowrap;
            gap: 20px;
        }
        .form-container {
            display: flex;
            flex-direction: column;
            width: 20%;
        }
        .form-columns {
            display: flex;
            justify-content: Left;
        }
        .form-column {
            width: 90%;
        }
        .table-container {
            width: 80%;
            overflow-x: auto;
        }
        form {
            padding: 1em;
            border: 2px solid #ccc;
            border-radius: 2em;
        }
        div + div {
            margin-top: 1em;
        }
        label {
            display: block;
            margin-bottom: .5em;
            color: #333333;
        }
        input, textarea, select {
            width: 60%;
            padding: .5em;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        input[readonly] {
            background-color: #f0f0f0;
        }
        button {
            padding: 0.7em;
            color: #fff;
            background-color: #007BFF;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 0.5em;
            text-align: left;
        }
        .settings {
            margin-top: 2em;
            border-top: 1px solid #ccc;
            padding-top: 1em;
        }
        .hidden {
            display: none;
        }
        .delete-btn {
            cursor: pointer;
            color: red;
            font-weight: bold;
        }

        .table-container {
            position: relative;
        }

        .export-btn-container {
            text-align: right;
            margin-top: 10px;
        }

        .export-btn {
            padding: 0.7em;
            color: #fff;
            background-color: #007BFF;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .export-btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<div id="loginScreen">
    <form id="loginForm">
        <h2>Login</h2>
        <label for="username">Username</label>
        <input type="text" id="username" name="username" required>
        <label for="password">Password</label>
        <input type="password" id="password" name="password" required>
        <button type="button" onclick="login()">Login</button>
    </form>
</div>

<div id="mainContent" style="display:none;">
    <h1 class="form-title">Plant Work Events Offline Tool</h1>
    <div class="container">
        <div class="form-container">
            <div class="form-columns">
                <div class="form-column">
                    <form id="mainForm">
                        <div>
                            <label for="submittedBy">Submitted by</label>
                            <select id="submittedBy" name="submittedBy" required>
                                <option value="" selected></option>
                            </select>
                        </div>
                        <div>
                            <label for="eventDate">Event Date</label>
                            <input type="date" id="eventDate" name="eventDate" required>
                        </div>
                        <div>
                            <label for="shift">Which Shift?</label>
                            <select id="shift" name="shift" required>
                                <option value="" selected></option>
                                <option value="1st Shift">1st Shift</option>
                                <option value="2nd Shift">2nd Shift</option>
                                <option value="3rd Shift">3rd Shift</option>
                            </select>
                        </div>
                        <div>
                            <label for="employeeCompletingEvent">Employee Completing Event</label>
                            <select id="employeeCompletingEvent" name="employeeCompletingEvent" required>
                                <option value="" selected></option>
                            </select>
                        </div>
                        <div>
                            <label for="roomEventOccurredIn">Room Event Occurred in</label>
                            <select id="roomEventOccurredIn" name="roomEventOccurredIn" onchange="showEventField()" required>
                                <option value="" selected></option>
                                <option value="Mom 1">Mom 1</option>
                                <option value="Mom 2">Mom 2</option>
                                <option value="Mom 3">Mom 3</option>
                                <option value="Veg 1">Veg 1</option>
                                <option value="Veg 2">Veg 2</option>
                                <option value="Veg 3">Veg 3</option>
                                <option value="Veg 4">Veg 4</option>
                                <option value="Veg 5">Veg 5</option>
                                <option value="Veg 6">Veg 6</option>
                                <option value="Flower 1">Flower 1</option>
                                <option value="Flower 2">Flower 2</option>
                                <option value="Flower 3">Flower 3</option>
                                <option value="Flower 4">Flower 4</option>
                                <option value="Flower 5">Flower 5</option>
                                <option value="Flower 6">Flower 6</option>
                                <option value="Flower 7">Flower 7</option>
                                <option value="Flower 8">Flower 8</option>
                                <option value="Flower 9">Flower 9</option>
                                <option value="Flower 10">Flower 10</option>
                                <option value="Flower 11">Flower 11</option>
                                <option value="Flower 12">Flower 12</option>
                                <option value="Flower 13">Flower 13</option>
                                <option value="Flower 14">Flower 14</option>
                                <option value="Flower 15">Flower 15</option>
                                <option value="Flower 16">Flower 16</option>
                                <option value="Flower 17">Flower 17</option>
                                <option value="Flower 18">Flower 18</option>
                            </select>
                        </div>
                        <div id="momEventContainer" class="hidden">
                            <label for="momEvent">Mom Event</label>
                            <select id="momEvent" name="momEvent">
                                <option value="1st topping">1st topping</option>
                                <option value="2nd topping">2nd topping</option>
                                <option value="Maintenance Topping">Maintenance Topping</option>
                                <option value="Defoliation">Defoliation</option>
                                <option value="Prune/Skirt">Prune/Skirt</option>
                            </select>
                        </div>
                        <div id="vegEventContainer" class="hidden">
                            <label for="vegEvent">Veg Event</label>
                            <select id="vegEvent" name="vegEvent">
                                <option value="Topping">Topping</option>
                                <option value="Prune/Skirt">Prune/Skirt</option>
                            </select>
                        </div>
                        <div id="flowerEventContainer" class="hidden">
                            <label for="flowerEvent">Flower Event</label>
                            <select id="flowerEvent" name="flowerEvent">
                                <option value="Flower Topping">Flower Topping</option>
                                <option value="21-Day Prune">21-Day Prune</option>
                                <option value="42-Day Defol">42-Day Defol</option>
                                <option value="Harvest defol">Harvest defol</option>
                                <option value="Necrotic leaf Defol">Necrotic leaf Defol</option>
                            </select>
                        </div>
                        <div>
                            <label for="weightIncludingBin">Weight of Material Including Bin (Kilograms)</label>
                            <input type="number" id="weightIncludingBin" name="weightIncludingBin" required>
                        </div>
                        <div>
                            <label for="numberOfBinsWeighed">Number of Bins Weighed</label>
                            <input type="number" id="numberOfBinsWeighed" name="numberOfBinsWeighed" required>
                        </div>
                        <div>
                            <label for="eventNotes">Event Notes (if applicable)</label>
                            <textarea id="eventNotes" name="eventNotes"></textarea>
                        </div>
                        <div>
                            <button type="button" onclick="addToTable()">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Action</th>
                        <th>Submitted by</th>
                        <th>Event Date</th>
                        <th>Which Shift?</th>
                        <th>Employee Completing Event</th>
                        <th>Room Event Occurred in</th>
                        <th>Mom Event</th>
                        <th>Veg Event</th>
                        <th>Flower Event</th>
                        <th>Weight of Material Including Bin (Kilograms)</th>
                        <th>Number of Bins Weighed</th>
                        <th>Event Notes (if applicable)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
            <div class="export-btn-container">
                <button type="button" onclick="exportToCSV()">Export to Excel</button>
            </div>
        </div>
    </div>
    <div class="settings">
        <div>
            <label for="fieldSelect">Select Field to Update</label>
            <select id="fieldSelect">
                <option value="names">Names</option>
            </select>
        </div>
        <div>
            <label for="fieldValues">Enter Values (comma-separated or line-separated)</label>
            <textarea id="fieldValues" placeholder="e.g. Cloner, Cutter, Trimmer or Cloner&#10;Cutter&#10;Trimmer"></textarea>
        </div>
        <div>
            <button type="button" onclick="updateField()">Update Field</button>
        </div>
    </div>
</div>

<script>
    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        if (password === "PWET") {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            localStorage.setItem('username', username);
        } else {
            alert('Incorrect password. Please try again.');
        }
    }

    function updateField() {
        const fieldSelect = document.getElementById('fieldSelect').value;
        const fieldValues = document.getElementById('fieldValues').value.split(/,|\n/).map(value => value.trim()).filter(value => value);

        if (fieldSelect === "names") {
            const nameFields = ["submittedBy", "employeeCompletingEvent"];
            nameFields.forEach(field => {
                const selectElement = document.getElementById(field);
                selectElement.innerHTML = ''; // Clear existing options

                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '';
                defaultOption.selected = true;
                selectElement.appendChild(defaultOption);

                fieldValues.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = value;
                    selectElement.appendChild(option);
                });

                // Set the value to empty string to clear the field
                selectElement.value = '';
            });
        } else {
            const selectElement = document.getElementById(fieldSelect);
            selectElement.innerHTML = ''; // Clear existing options

            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '';
            defaultOption.selected = true;
            selectElement.appendChild(defaultOption);

            fieldValues.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                selectElement.appendChild(option);
            });

            // Set the value to empty string to clear the field
            selectElement.value = '';
        }

        // Save to localStorage
        localStorage.setItem(fieldSelect, JSON.stringify(fieldValues));

        document.getElementById('fieldValues').value = ''; // Clear the input field
        alert(`${fieldSelect} updated successfully!`);
    }

    function addToTable() {
        const form = document.getElementById('mainForm');
        const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        const newRow = table.insertRow();
        
        const deleteCell = newRow.insertCell();
        deleteCell.innerHTML = '<span class="delete-btn" onclick="deleteRow(this)">üóëÔ∏è</span>';
        
        const fields = [
            'submittedBy', 'eventDate', 'shift', 'employeeCompletingEvent', 'roomEventOccurredIn',
            'momEvent', 'vegEvent', 'flowerEvent', 'weightIncludingBin', 'numberOfBinsWeighed', 'eventNotes'
        ];
        
        fields.forEach(field => {
            const cell = newRow.insertCell();
            const inputField = form.querySelector(`[name="${field}"]`);
            cell.textContent = inputField ? inputField.value : '';
        });

        form.reset();
        resetSelectFields();
        hideEventFields();

        saveTableData(); // Save the table data to localStorage
    }

    function deleteRow(btn) {
        const row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
        saveTableData();
    }

    function resetSelectFields() {
        const selectFields = document.querySelectorAll('select');
        selectFields.forEach(select => {
            select.value = "";
        });
    }

function showEventField() {
    const room = document.getElementById('roomEventOccurredIn').value;
    hideEventFields();
    clearEventFields();

    if (room.startsWith('Mom')) {
        document.getElementById('momEventContainer').classList.remove('hidden');
    } else if (room.startsWith('Veg')) {
        document.getElementById('vegEventContainer').classList.remove('hidden');
    } else if (room.startsWith('Flower')) {
        document.getElementById('flowerEventContainer').classList.remove('hidden');
    }
}

function clearEventFields() {
    document.getElementById('momEvent').value = '';
    document.getElementById('vegEvent').value = '';
    document.getElementById('flowerEvent').value = '';
}


    function hideEventFields() {
        document.getElementById('momEventContainer').classList.add('hidden');
        document.getElementById('vegEventContainer').classList.add('hidden');
        document.getElementById('flowerEventContainer').classList.add('hidden');
    }

    document.addEventListener('DOMContentLoaded', function() {
        loadSettings();
        loadTableData();
        if (localStorage.getItem('username')) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        } else {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
        }
    });

    function loadSettings() {
        const fieldSelect = document.getElementById('fieldSelect').value;
        const savedNames = localStorage.getItem('names');
        const savedStrains = localStorage.getItem('strain');
        const savedRooms = localStorage.getItem('rooms');

        if (savedNames) {
            const nameFields = ["submittedBy", "employeeCompletingEvent"];
            const fieldValues = JSON.parse(savedNames);

            nameFields.forEach(field => {
                const selectElement = document.getElementById(field);
                selectElement.innerHTML = ''; // Clear existing options

                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '';
                defaultOption.selected = true;
                selectElement.appendChild(defaultOption);

                fieldValues.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = value;
                    selectElement.appendChild(option);
                });

                // Set the value to empty string to clear the field
                selectElement.value = '';
            });
        }

        if (savedStrains) {
            const selectElement = document.getElementById('strain');
            const fieldValues = JSON.parse(savedStrains);
            selectElement.innerHTML = ''; // Clear existing options

            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '';
            defaultOption.selected = true;
            selectElement.appendChild(defaultOption);

            fieldValues.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                selectElement.appendChild(option);
            });

            // Set the value to empty string to clear the field
            selectElement.value = '';
        }

        if (savedRooms) {
            const selectElement = document.getElementById('roomEventOccurredIn');
            const fieldValues = JSON.parse(savedRooms);
            selectElement.innerHTML = ''; // Clear existing options

            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '';
            defaultOption.selected = true;
            selectElement.appendChild(defaultOption);

            fieldValues.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                selectElement.appendChild(option);
            });

            // Set the value to empty string to clear the field
            selectElement.value = '';
        }
    }

    function saveTableData() {
        const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        const rows = Array.from(table.rows);
        const tableData = rows.map(row => {
            return Array.from(row.cells).slice(1).map(cell => cell.textContent); // Exclude the first cell (trash icon)
        });
        localStorage.setItem('tableData', JSON.stringify(tableData));
    }

    function loadTableData() {
        const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        const tableData = JSON.parse(localStorage.getItem('tableData') || '[]');
        tableData.forEach(rowData => {
            const newRow = table.insertRow();
            const deleteCell = newRow.insertCell();
            deleteCell.innerHTML = '<span class="delete-btn" onclick="deleteRow(this)">üóëÔ∏è</span>';
            rowData.forEach(cellData => {
                const cell = newRow.insertCell();
                cell.textContent = cellData;
            });
        });
    }

    function exportToCSV() {
        const tableData = JSON.parse(localStorage.getItem('tableData') || '[]');
        if (tableData.length === 0) {
            alert('No data to export.');
            return;
        }

        const headers = [
            'Submitted by', 'Event Date', 'Which Shift?', 'Employee Completing Event', 'Room Event Occurred in',
            'Mom Event', 'Veg Event', 'Flower Event', 'Weight of Material Including Bin (Kilograms)', 
            'Number of Bins Weighed', 'Event Notes (if applicable)'
        ];

        const csvContent = [
            headers.join(','), // Add the headers
            ...tableData.map(row => row.map(cell => `"${cell}"`).join(',')) // Add the rows
        ].join('\n');

        // Get username from localStorage
        const username = localStorage.getItem('username') || 'user';

        // Get current date and time
        const now = new Date();
        const formattedDate = now.toISOString().split('T')[0];
        const formattedTime = now.toTimeString().split(' ')[0].replace(/:/g, '-');

        // Create the file name
        const fileName = `${username}_${formattedDate}_${formattedTime}_PWET.csv`;

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', fileName);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Clear the data table after download
        clearTableData();
    }

    function clearTableData() {
        const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        while (table.firstChild) {
            table.removeChild(table.firstChild);
        }
        localStorage.removeItem('tableData');
    }
</script>

</body>
</html>


